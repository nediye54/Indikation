<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Diagnose – MDG</title>
  <meta name="description" content="In wenigen Minuten zur Entscheidungssicherheit: Instabilität früh erkennen, Ursache präzise diagnostizieren, Architektur bauen." />
  <link rel="stylesheet" href="./style.css" />
  <style>
    .dx-wrap{ max-width: 1120px; margin: 0 auto; padding: 1.25rem 1rem 3rem; }
    .dx-top{ display:grid; grid-template-columns: 1.1fr .9fr; gap:1rem; align-items:start; }
    .dx-actions{ display:flex; gap:.65rem; flex-wrap:wrap; align-items:center; }
    .dx-kpi{ display:flex; gap:.5rem; flex-wrap:wrap; margin-top:.8rem; }
    .dx-kpi .pill{ white-space:nowrap; }
    .dx-grid{ display:grid; grid-template-columns: 1fr; gap:.75rem; margin-top:.6rem; }
    .dx-field{ display:grid; gap:.35rem; }
    .dx-label{ font-weight: 800; color: var(--muted, #aab); }
    .dx-help{ font-size:.9rem; color: var(--muted, #aab); line-height:1.35; }
    .dx-help b{ color: var(--text, #fff); }
    .dx-rangeRow{ display:grid; grid-template-columns: 1fr auto; gap:.7rem; align-items:center; }
    .dx-rangeVal{ font-weight: 900; min-width: 2.2rem; text-align:right; }
    .dx-divider{ height:1px; background: rgba(255,255,255,.08); margin: .9rem 0; }
    .dx-questions{ display:grid; gap: 1rem; margin-top: 1rem; }
    .dx-q{ padding-top:.9rem; border-top: 1px solid rgba(255,255,255,.08); }
    .dx-q:first-child{ border-top: 0; padding-top: 0; }
    .dx-qtitle{ font-weight: 950; margin-bottom:.35rem; }
    .dx-example{ margin-top:.25rem; display:grid; gap:.25rem; }
    .dx-example .ex{ font-size:.9rem; color: var(--muted, #aab); }
    .dx-example .ex::before{ content:"• "; opacity:.9; }
    .dx-output pre{ white-space: pre-wrap; word-break: break-word; }
    .dx-report{ margin-top: 1rem; }
    .dx-reportGrid{ display:grid; grid-template-columns: 1fr; gap:1rem; }
    .dx-reportBox{ padding: 1rem; border:1px solid rgba(255,255,255,.10); border-radius: var(--radius2, 18px); background: rgba(255,255,255,.02); }
    .dx-reportBox h3{ margin:0 0 .6rem; }
    .dx-badges{ display:flex; gap:.5rem; flex-wrap:wrap; }
    .dx-note{ font-size:.9rem; color: var(--muted, #aab); }
    @media (max-width: 980px){ .dx-top{ grid-template-columns: 1fr; } }
  </style>
</head>

<body>
  <a class="skip-link" href="#main">Skip</a>

  <header class="header" id="top">
    <div class="container header__inner">
      <a class="brand" href="./index.html" aria-label="Home">
        <span class="brand__mark" aria-hidden="true">MDG</span>
        <span class="brand__text">v4</span>
      </a>

      <nav class="nav" aria-label="Main">
        <a class="nav__link" href="./how.html" data-i18n="nav.how">How it works</a>
        <a class="nav__link" href="./why.html" data-i18n="nav.why">Why MDG</a>
        <a class="nav__link" href="./faq.html" data-i18n="nav.faq">FAQ</a>
      </nav>

      <div class="header__actions">
        <div class="lang" role="group" aria-label="Language">
          <button class="chip chip--ghost" type="button" data-lang="de" aria-pressed="true">DE</button>
          <button class="chip chip--ghost" type="button" data-lang="tr" aria-pressed="false">TR</button>
          <button class="chip chip--ghost" type="button" data-lang="en" aria-pressed="false">EN</button>
        </div>
        <a class="btn btn--ghost" href="./index.html" data-i18n="cta.backHome">Home</a>
      </div>

      <button class="burger" type="button" aria-label="Menu" aria-expanded="false">
        <span></span><span></span><span></span>
      </button>
    </div>

    <div class="drawer" hidden>
      <div class="drawer__content">
        <a class="drawer__link" href="./how.html" data-i18n="nav.how">How it works</a>
        <a class="drawer__link" href="./why.html" data-i18n="nav.why">Why MDG</a>
        <a class="drawer__link" href="./faq.html" data-i18n="nav.faq">FAQ</a>
        <div class="drawer__sep"></div>
        <a class="btn btn--ghost btn--full" href="./index.html" data-i18n="cta.backHome">Home</a>
      </div>
    </div>
  </header>

  <main id="main">
    <div class="dx-wrap">
      <div class="section__head">
        <h1 class="h2" data-i18n="dx.title">Diagnosis</h1>
        <p class="sub" data-i18n="dx.sub">
          In a few minutes to decision-confidence: detect instability early, diagnose precisely, build architecture.
        </p>
      </div>

      <div class="dx-top">
        <!-- LEFT: input -->
        <div class="card">
          <h2 class="h3" data-i18n="dx.contextTitle">1) Context</h2>

          <div class="dx-grid">
            <div class="dx-field">
              <div class="dx-label" data-i18n="dx.mode">Mode</div>
              <div class="dx-badges">
                <span class="pill pill--muted" id="modeBadge">—</span>
                <span class="pill pill--muted" id="tokenBadge" style="display:none;">Token: ✓</span>
              </div>
              <div class="dx-help" id="modeHint"></div>
            </div>

            <div class="dx-field">
              <label class="dx-label" for="goalSelect" data-i18n="dx.goal">Goal</label>
              <select class="dx-input" id="goalSelect">
                <option value="stabilize" data-i18n="dx.goal.stabilize">Stabilize (reduce tension fast)</option>
                <option value="rebuild" data-i18n="dx.goal.rebuild">Rebuild (change architecture)</option>
              </select>
              <div class="dx-help" id="goalHelp"></div>
            </div>

            <div class="dx-field">
              <label class="dx-label" for="oneLiner" data-i18n="dx.oneliner">Describe the situation in one sentence</label>
              <input class="dx-input" id="oneLiner" type="text" maxlength="160" placeholder="…" />
              <div class="dx-help" id="oneLinerHelp"></div>
            </div>

            <div class="dx-divider"></div>

            <h2 class="h3" style="margin:0;" data-i18n="dx.scanTitle">2) Quick Scan (sliders)</h2>

            <div class="dx-field">
              <div class="dx-qtitle" data-i18n="q.load.title">Load & bottlenecks</div>
              <div class="dx-help" id="exLoad"></div>
              <div class="dx-rangeRow">
                <input id="sLoad" class="dx-range" type="range" min="0" max="6" step="1" value="2" />
                <div class="dx-rangeVal" id="vLoad">2</div>
              </div>
            </div>

            <div class="dx-field">
              <div class="dx-qtitle" data-i18n="q.decisions.title">Decision architecture</div>
              <div class="dx-help" id="exDecisions"></div>
              <div class="dx-rangeRow">
                <input id="sDecisions" class="dx-range" type="range" min="0" max="6" step="1" value="2" />
                <div class="dx-rangeVal" id="vDecisions">2</div>
              </div>
            </div>

            <div class="dx-field">
              <div class="dx-qtitle" data-i18n="q.energy.title">Energy & error handling</div>
              <div class="dx-help" id="exEnergy"></div>
              <div class="dx-rangeRow">
                <input id="sEnergy" class="dx-range" type="range" min="0" max="6" step="1" value="2" />
                <div class="dx-rangeVal" id="vEnergy">2</div>
              </div>
            </div>

            <div class="dx-field">
              <div class="dx-qtitle" data-i18n="q.growth.title">Growth pressure / complexity</div>
              <div class="dx-help" id="exGrowth"></div>
              <div class="dx-rangeRow">
                <input id="sGrowth" class="dx-range" type="range" min="0" max="6" step="1" value="2" />
                <div class="dx-rangeVal" id="vGrowth">2</div>
              </div>
            </div>

            <div class="dx-field">
              <div class="dx-qtitle" data-i18n="q.power.title">Power–responsibility alignment</div>
              <div class="dx-help" id="exPower"></div>
              <div class="dx-rangeRow">
                <input id="sPower" class="dx-range" type="range" min="0" max="6" step="1" value="2" />
                <div class="dx-rangeVal" id="vPower">2</div>
              </div>
            </div>

            <div class="dx-divider"></div>

            <h2 class="h3" style="margin:0;" data-i18n="dx.moreTitle">3) Precision Questions (adaptive)</h2>
            <div class="dx-help" data-i18n="dx.moreHint">
              Answer the follow-up questions. They increase precision. Each question includes 2 simple examples.
            </div>

            <div class="dx-questions" id="questions"></div>

            <!-- ✅ Buttons exist AND match JS -->
            <div class="dx-actions" style="margin-top: .9rem;">
              <button class="btn btn--primary" type="button" id="runBtn" data-i18n="dx.run">Run assessment</button>
              <button class="btn btn--ghost" type="button" id="resetBtn" data-i18n="dx.reset">Reset</button>
              <button class="btn btn--ghost" type="button" id="pdfBtn">Premium PDF</button>
              <span class="micro" id="statusLine">—</span>
            </div>

            <div class="dx-kpi">
              <span class="pill pill--muted" id="kpiPrimary">Primary: —</span>
              <span class="pill pill--muted" id="kpiPath">Path: —</span>
              <span class="pill pill--muted" id="kpiRisk">Risk: —</span>
            </div>
          </div>
        </div>

        <!-- RIGHT: output -->
        <div class="card dx-output">
          <h2 class="h3" data-i18n="dx.outputTitle">Strategic Output</h2>
          <p class="micro" data-i18n="dx.outputHint">
            You will get: primary instability, why it happens, what to do now, and what to rebuild.
          </p>

          <div class="dx-reportGrid">
            <div class="dx-reportBox">
              <h3 class="h3" style="margin-top:0;" data-i18n="dx.assessmentTitle">Assessment</h3>
              <pre id="resultText" class="micro" style="margin:0;">—</pre>
            </div>

            <div class="dx-reportBox">
              <h3 class="h3" style="margin-top:0;" data-i18n="dx.execTitle">Executive Report (Premium)</h3>
              <p class="dx-note" id="execHint"></p>

              <!-- ✅ exec/copy only once -->
              <div class="dx-actions" style="margin-top:.6rem;">
                <button class="btn btn--primary" type="button" id="execBtn" data-i18n="dx.execBtn">Generate Executive Report</button>
                <button class="btn btn--ghost" type="button" id="copyExecBtn" disabled data-i18n="dx.copy">Copy</button>
              </div>

              <div class="dx-report" id="reportContainer" style="display:none;">
                <pre id="execText" class="micro" style="margin: .8rem 0 0;">—</pre>
              </div>
            </div>
          </div>

          <p class="micro" style="margin-top:1rem; opacity:.85;" data-i18n="dx.privacy">
            Privacy: inputs are processed via API only to generate the assessment/report.
          </p>
        </div>
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="container footer__grid">
      <div>
        <div class="brand brand--footer">
          <span class="brand__mark" aria-hidden="true">MDG</span>
          <span class="brand__text">v4</span>
        </div>
        <p class="micro" data-i18n="footer.tag">Structure diagnosis for stabilization and rebuild.</p>
      </div>
      <div class="footer__legal">
        <a href="./impressum.html" rel="nofollow">Impressum</a>
        <a href="./datenschutz.html" rel="nofollow">Datenschutz</a>
        <a href="./kontakt.html" rel="nofollow">Kontakt</a>
      </div>
    </div>
  </footer>

  <script>
  (() => {
    const API_BASE = "https://api.mdg-indikation.de";
    const $ = (s, r=document) => r.querySelector(s);
    const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));

    // Drawer
    const burger = $(".burger");
    const drawer = $(".drawer");
    if (burger && drawer) {
      burger.addEventListener("click", () => {
        const open = !drawer.hasAttribute("hidden");
        if (open) {
          drawer.setAttribute("hidden", "");
          burger.setAttribute("aria-expanded", "false");
        } else {
          drawer.removeAttribute("hidden");
          burger.setAttribute("aria-expanded", "true");
        }
      });
    }

    // Mode & token
    const params = new URLSearchParams(location.search);
    const modeParam = (params.get("mode") || "").toLowerCase();
    const ss = window.sessionStorage;
    const ls = window.localStorage;

    const storedMode = ((ss.getItem("mdg_mode") || ls.getItem("mdg_mode") || "")).toLowerCase();
    const businessOk = (ss.getItem("mdg_business_ok") === "1") || (ls.getItem("mdg_business_ok") === "1");

    const tokenStored =
      (ss.getItem("mdg_business_token") || ls.getItem("mdg_business_token") || ls.getItem("mdg_token") || "").trim();

    const wantsBusiness = (modeParam === "business") || (storedMode === "business");
    const mode = (wantsBusiness && businessOk) ? "business" : "private";

    $("#modeBadge").textContent = (mode === "business") ? "Business" : "Private";
    if (mode === "business") $("#tokenBadge").style.display = "";

    // i18n (short)
    const dict = {
      de: {
        "nav.how":"Wie es funktioniert","nav.why":"Warum MDG","nav.faq":"FAQ","cta.backHome":"Zur Homepage",
        "dx.title":"Diagnose","dx.sub":"In wenigen Minuten zur Entscheidungssicherheit: Instabilität früh erkennen, Ursache präzise diagnostizieren, Architektur bauen.",
        "dx.contextTitle":"1) Kontext","dx.mode":"Modus","dx.goal":"Ziel",
        "dx.goal.stabilize":"Stabilisieren (Spannung schnell senken)","dx.goal.rebuild":"Umbauen (Architektur verändern)",
        "dx.oneliner":"Beschreibe die Situation in einem Satz","dx.scanTitle":"2) Quick Scan (Slider)",
        "dx.moreTitle":"3) Präzisionsfragen (adaptiv)","dx.moreHint":"Beantworte die Folgefragen. Sie erhöhen die Präzision. Jede Frage hat 2 Beispiele.",
        "dx.run":"Diagnose starten","dx.reset":"Zurücksetzen",
        "dx.outputTitle":"Output","dx.outputHint":"Du erhältst: Primärinstabilität, warum sie entsteht, Sofortmaßnahmen und Umbaupfad.",
        "dx.assessmentTitle":"Strategisches Assessment","dx.execTitle":"Executive Report (Premium)","dx.execBtn":"Executive Report erzeugen","dx.copy":"Kopieren",
        "dx.privacy":"Datenschutz: Inputs werden via API nur zur Generierung von Assessment/Report verarbeitet.",
        "footer.tag":"Strukturdiagnose für Stabilisierung und Umbau.",
        "q.load.title":"Last & Engpässe","q.decisions.title":"Entscheidungsarchitektur","q.energy.title":"Energie & Fehlerkultur","q.growth.title":"Wachstumsdruck / Komplexität","q.power.title":"Macht–Verantwortung (Alignment)"
      },
      tr: {
        "nav.how":"Nasıl çalışır","nav.why":"Neden MDG","nav.faq":"SSS","cta.backHome":"Anasayfa",
        "dx.title":"Analiz","dx.sub":"Birkaç dakika içinde karar güveni: istikrarsızlığı erken gör, nedeni doğru teşhis et, mimari kur.",
        "dx.contextTitle":"1) Bağlam","dx.mode":"Mod","dx.goal":"Hedef",
        "dx.goal.stabilize":"Stabilize et (gerilimi hızlı düşür)","dx.goal.rebuild":"Yeniden kur (mimariyi değiştir)",
        "dx.oneliner":"Durumu tek cümleyle anlat","dx.scanTitle":"2) Hızlı tarama (Slider)",
        "dx.moreTitle":"3) Kesinleştirme soruları","dx.moreHint":"Takip sorularını yanıtla. Kesinliği artırır. Her soruda 2 örnek var.",
        "dx.run":"Başlat","dx.reset":"Sıfırla",
        "dx.outputTitle":"Çıktı","dx.outputHint":"Alacağın: ana instabilite, nedenleri, hemen yapılacaklar ve dönüşüm yolu.",
        "dx.assessmentTitle":"Stratejik değerlendirme","dx.execTitle":"Yönetici Raporu (Premium)","dx.execBtn":"Yönetici raporu üret","dx.copy":"Kopyala",
        "dx.privacy":"Gizlilik: Veriler yalnızca rapor üretimi için API üzerinden işlenir.",
        "footer.tag":"Stabilizasyon ve yeniden kurulum için yapı teşhisi.",
        "q.load.title":"Yük & darboğazlar","q.decisions.title":"Karar mimarisi","q.energy.title":"Enerji & hata kültürü","q.growth.title":"Büyüme baskısı / karmaşıklık","q.power.title":"Güç–sorumluluk uyumu"
      },
      en: {
        "nav.how":"How it works","nav.why":"Why MDG","nav.faq":"FAQ","cta.backHome":"Home",
        "dx.title":"Diagnosis","dx.sub":"In a few minutes to decision-confidence: detect instability early, diagnose precisely, build architecture.",
        "dx.contextTitle":"1) Context","dx.mode":"Mode","dx.goal":"Goal",
        "dx.goal.stabilize":"Stabilize (reduce tension fast)","dx.goal.rebuild":"Rebuild (change architecture)",
        "dx.oneliner":"Describe the situation in one sentence","dx.scanTitle":"2) Quick Scan (sliders)",
        "dx.moreTitle":"3) Precision Questions (adaptive)","dx.moreHint":"Answer the follow-up questions. They increase precision. Each question includes 2 examples.",
        "dx.run":"Run assessment","dx.reset":"Reset",
        "dx.outputTitle":"Output","dx.outputHint":"You will get: primary instability, why it happens, what to do now, and what to rebuild.",
        "dx.assessmentTitle":"Strategic Assessment","dx.execTitle":"Executive Report (Premium)","dx.execBtn":"Generate Executive Report","dx.copy":"Copy",
        "dx.privacy":"Privacy: inputs are processed via API only to generate the assessment/report.",
        "footer.tag":"Structure diagnosis for stabilization and rebuild.",
        "q.load.title":"Load & bottlenecks","q.decisions.title":"Decision architecture","q.energy.title":"Energy & error handling","q.growth.title":"Growth pressure / complexity","q.power.title":"Power–responsibility alignment"
      }
    };

    function getLang(){
      const pressed = $$("[data-lang]").find(b => b.getAttribute("aria-pressed") === "true");
      return pressed?.dataset.lang || "de";
    }

    function applyLang(lang){
      if(!dict[lang]) lang = "en";
      document.documentElement.lang = lang;
      $$("[data-lang]").forEach(b => b.setAttribute("aria-pressed", String(b.dataset.lang === lang)));
      $$("[data-i18n]").forEach(el => {
        const k = el.dataset.i18n;
        const v = dict[lang][k];
        if (v) el.textContent = v;
      });
      renderHints(lang);
      renderExamples(lang);
      renderAdaptiveQuestions(lang);
    }
    $$("[data-lang]").forEach(btn => btn.addEventListener("click", () => applyLang(btn.dataset.lang)));

    function renderHints(lang){
      const t = (de,tr,en) => (lang==="de"?de:(lang==="tr"?tr:en));
      $("#statusLine").textContent = t("Status: bereit","Durum: hazır","Status: ready");
      $("#execText").textContent = "—";
      $("#resultText").textContent = "—";
      $("#copyExecBtn").disabled = true;
      $("#reportContainer").style.display = "none";
    }

    function renderExamples(lang){
      const business = (mode === "business");
      const t = (de,tr,en) => (lang==="de"?de:(lang==="tr"?tr:en));

      $("#modeHint").innerHTML = (wantsBusiness && !businessOk)
        ? t("Business-Zugang nicht aktiv. Bitte Token über die Landingpage bestätigen.","Business erişimi aktif değil. Token’ı ana sayfada doğrula.","Business access not active. Verify token on landing page.")
        : (business
            ? t("Business-Modus: Fragen & Beispiele sind auf Unternehmen zugeschnitten.","Business modu: şirket odaklı.","Business mode: company-focused.")
            : t("Privat-Modus: Fokus auf persönliche Systeme.","Özel mod: kişisel odak.","Private mode: personal focus.")
          );

      $("#goalHelp").innerHTML = t(
        "<b>Stabilisieren</b> = Sofortmaßnahmen. <b>Umbauen</b> = Strukturänderungen.",
        "<b>Stabilize</b> = hızlı rahatlat. <b>Yeniden kur</b> = yapı değiştir.",
        "<b>Stabilize</b> = immediate moves. <b>Rebuild</b> = structural changes."
      );

      $("#oneLinerHelp").innerHTML = business
        ? t("Beispiel: <b>„Entscheidungen hängen an 1 Person.“</b>","Örnek: <b>“Kararlar 1 kişiye bağlı.”</b>","Example: <b>“Decisions depend on one person.”</b>")
        : t("Beispiel: <b>„Ich verliere Kontrolle über meinen Alltag.“</b>","Örnek: <b>“Günlük hayat kontrolüm kayıyor.”</b>","Example: <b>“I lose control of my daily life.”</b>");

      $("#execHint").textContent = business
        ? t("Business-Report: Rollen, Operating Model, KPIs, 30-60-90.","Business: roller, KPI, 30-60-90.","Business: roles, KPIs, 30-60-90.")
        : t("Privat-Report: Logik, Prioritäten, konkrete Moves.","Özel: mantık, öncelik, adım.","Private: logic, priorities, moves.");
    }

    function escapeHtml(s){
      return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;");
    }

    function renderAdaptiveQuestions(lang){
      const business = (mode === "business");
      const t = (de,tr,en) => (lang==="de"?de:(lang==="tr"?tr:en));

      const qs = business ? [
        { id:"b_q1", title:t("Wo entsteht die größte Verzögerung?","En büyük gecikme nerede?","Where is the biggest delay?"),
          options:[
            {v:"decisions",label:t("Entscheidungen","Kararlar","Decisions")},
            {v:"handoff",label:t("Übergaben","Devir","Handoffs")},
            {v:"quality",label:t("Qualität/Rework","Kalite","Quality")},
            {v:"capacity",label:t("Kapazität","Kapasite","Capacity")},
          ],
          ex:[t("„Freigaben brauchen immer den CEO.“","“Onaylar CEO’da.”","“Approvals always need the CEO.”"),
              t("„Team A wartet auf Team B.“","“A, B’yi bekliyor.”","“Team A waits for Team B.”")]
        }
      ] : [
        { id:"p_q1", title:t("Was ist der Haupt-Auslöser?","Ana tetikleyici?","Main trigger?"),
          options:[
            {v:"time",label:t("Zeitdruck","Zaman baskısı","Time pressure")},
            {v:"conflict",label:t("Konflikt","Çatışma","Conflict")},
            {v:"uncertainty",label:t("Unklarheit","Belirsizlik","Uncertainty")},
            {v:"energy",label:t("Energie","Enerji","Energy")},
          ],
          ex:[t("„Ich schiebe Entscheidungen.“","“Kararı erteliyorum.”","“I delay decisions.”"),
              t("„Kleine Themen eskalieren.“","“Küçük şeyler büyür.”","“Small topics escalate.”")]
        }
      ];

      const
