<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MDG – In wenigen Minuten zur Entscheidungssicherheit</title>
  <meta name="description" content="Instabilität früh erkennen. Ursache präzise diagnostizieren. Tragfähige Architektur bauen – bevor es bricht." />
  <link rel="stylesheet" href="./style.css" />
</head>

<body>

<header class="header">
  <div class="container header__inner">
    <div class="brand">
      <span class="brand__mark">MDG</span>
      <span>v4</span>
    </div>

    <nav class="nav">
      <a class="nav__link" href="#how">Wie es funktioniert</a>
      <a class="nav__link" href="#why">Warum MDG</a>
      <a class="nav__link" href="#faq">FAQ</a>
    </nav>
  </div>
</header>

<section class="section section--hero">
  <div class="container hero">

    <div>
      <h1 class="h1">
        Instabilität früh erkennen.<br>
        Ursache präzise diagnostizieren.<br>
        Architektur bauen, bevor es bricht.
      </h1>

      <p class="lead">
        MDG, IDG und ADG geben dir ein strukturelles Instrumentarium,
        um Spannungen sichtbar zu machen und tragfähige Entscheidungen zu treffen.
      </p>

      <div class="hero__cta">
        <button id="cta_private" class="btn btn--primary">
          Jetzt ermitteln (privat)
        </button>

        <button id="cta_business" class="btn btn--ghost">
          Für Unternehmen
        </button>
      </div>

      <p class="micro" style="margin-top:14px;">
        Privat: sofort starten. Business: Token erforderlich.
      </p>
    </div>

  </div>
</section>

<!-- ============================= -->
<!-- BUSINESS MODAL -->
<!-- ============================= -->

<div id="business_overlay"></div>

<div id="business_modal" class="modal">
  <div class="modal__card">

    <div class="modal__head">
      <div>
        <div class="pill pill--muted">Business Zugang</div>
        <h3 style="margin-top:10px;">Token eingeben</h3>
      </div>

      <button id="business_close" class="btn btn--ghost">✕</button>
    </div>

    <p class="p">
      Unternehmen erhalten ein eigenes Fragen-Set
      und Executive Output. Bitte Token eingeben.
    </p>

    <label class="dx-label">Token</label>
    <input id="business_token" class="dx-input" placeholder="MDG-XXXX-XXXX" />

    <div style="display:flex; gap:10px; margin-top:20px;">
      <button id="business_submit" class="btn btn--primary">Weiter</button>
      <button id="business_cancel" class="btn btn--ghost">Abbrechen</button>
    </div>

  </div>
</div>

<!-- ============================= -->
<!-- SCRIPT -->
<!-- ============================= -->

<script>
(() => {

  const API_BASE = "https://api.mdg-indikation.de";

  const K_MODE  = "mdg_mode";
  const K_TOKEN = "mdg_token";

  const modal   = document.getElementById("business_modal");
  const overlay = document.getElementById("business_overlay");

  const openBtn   = document.getElementById("cta_business");
  const privateBtn= document.getElementById("cta_private");

  const closeBtn  = document.getElementById("business_close");
  const cancelBtn = document.getElementById("business_cancel");
  const submitBtn = document.getElementById("business_submit");
  const tokenInput= document.getElementById("business_token");

  function openModal(){
    modal.style.display = "flex";
    overlay.style.display = "block";
    tokenInput.focus();
  }

  function closeModal(){
    modal.style.display = "none";
    overlay.style.display = "none";
  }

  // ---------- PRIVATE FLOW ----------
  privateBtn.addEventListener("click", (e)=>{
    e.preventDefault();
    localStorage.setItem(K_MODE,"private");
    window.location.href="diagnose.html?mode=private";
  });

  // ---------- BUSINESS FLOW ----------
  openBtn.addEventListener("click", (e)=>{
    e.preventDefault();
    localStorage.setItem(K_MODE,"business");
    openModal();
  });

  // ---------- CLOSE OPTIONS ----------
  closeBtn.addEventListener("click", closeModal);
  cancelBtn.addEventListener("click", closeModal);
  overlay.addEventListener("click", closeModal);

  document.addEventListener("keydown",(e)=>{
    if(e.key==="Escape") closeModal();
  });

  // ---------- SUBMIT TOKEN ----------
  submitBtn.addEventListener("click", async ()=>{
    const token = tokenInput.value.trim();
    if(!token){
      alert("Bitte Token eingeben.");
      return;
    }

    try{
      const res = await fetch(API_BASE + "/api/token/verify",{
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ token })
      });

      if(!res.ok){
        alert("Token ungültig.");
        return;
      }

      localStorage.setItem(K_TOKEN,token);
      closeModal();
      window.location.href="diagnose.html?mode=business";

    }catch(err){
      alert("Serverfehler.");
    }
  });

})();
</script>

</body>
</html>
