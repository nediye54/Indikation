<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MDG – In wenigen Minuten zur Entscheidungssicherheit</title>
  <meta name="description" content="Instabilität früh erkennen, Ursache präzise diagnostizieren, Architektur bauen." />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=DM+Mono:ital,wght@0,400;0,500;1,400&family=Outfit:wght@400;500;600;700;800;900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="./style.css" />
  <style>
    .hero__actions{
      display:flex;
      gap:.75rem;
      flex-wrap:wrap;
      align-items:center;
      margin-top:1.2rem;
    }

    /* Modal */
    .modal[hidden]{ display:none !important; }
    .modal{
      position:fixed;
      inset:0;
      z-index:50;
      display:grid;
      place-items:center;
      background:rgba(0,0,0,.55);
      padding:1rem;
    }
    .modal__card{
      width:min(520px,100%);
      border-radius:var(--radius);
      border:1px solid var(--stroke);
      background:rgba(10,14,22,.92);
      backdrop-filter:blur(10px);
      padding:1.5rem;
    }
    .modal__top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:.75rem;
      margin-bottom:.85rem;
    }
    .modal__tag{
      display:inline-flex;
      align-items:center;
      gap:.4rem;
      padding:.2rem .55rem;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.04);
      font-size:.82rem;
      color:var(--muted);
    }
    .modal__x{
      width:36px; height:36px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.04);
      color:var(--text);
      cursor:pointer;
      display:grid;
      place-items:center;
      font-size:1.1rem;
      flex-shrink:0;
    }
    .modal__x:hover{ border-color:var(--primary); }
    .modal__grid{ display:grid; gap:.65rem; }
    .modal__label{ font-weight:800; font-size:.8rem; letter-spacing:.06em; text-transform:uppercase; color:var(--muted-2); }
    .modal__row{
      display:flex;
      gap:.6rem;
      flex-wrap:wrap;
      align-items:center;
      margin-top:.6rem;
    }
    .modal__status{ font-family:var(--font-mono); font-size:.8rem; color:var(--muted-2); }
  </style>
</head>
<body>

<header class="header" id="top">
  <div class="container header__inner">
    <a class="brand" href="./index.html" aria-label="Home">
      <span class="brand__mark" aria-hidden="true">MDG</span>
    </a>

    <nav class="nav" aria-label="Main">
      <a class="nav__link" href="./how.html" data-i18n="nav.how">Wie es funktioniert</a>
      <a class="nav__link" href="./why.html" data-i18n="nav.why">Warum MDG</a>
      <a class="nav__link" href="./faq.html" data-i18n="nav.faq">FAQ</a>
    </nav>

    <div class="header__actions">
      <div class="lang" role="group" aria-label="Language">
        <button class="chip chip--ghost" type="button" data-lang="de" aria-pressed="true">DE</button>
        <button class="chip chip--ghost" type="button" data-lang="tr" aria-pressed="false">TR</button>
        <button class="chip chip--ghost" type="button" data-lang="en" aria-pressed="false">EN</button>
      </div>
    </div>

    <button class="burger" type="button" aria-label="Menu" aria-expanded="false">
      <span></span><span></span><span></span>
    </button>
  </div>

  <div class="drawer" hidden>
    <div class="drawer__content">
      <a class="drawer__link" href="./how.html" data-i18n="nav.how">Wie es funktioniert</a>
      <a class="drawer__link" href="./why.html" data-i18n="nav.why">Warum MDG</a>
      <a class="drawer__link" href="./faq.html" data-i18n="nav.faq">FAQ</a>
    </div>
  </div>
</header>

<main id="main">
  <section class="hero">
    <div class="container hero__inner">
      <div class="hero__copy">
        <h1 class="h1" data-i18n="hero.title">Instabilität früh erkennen. Ursache präzise diagnostizieren. Architektur bauen.</h1>
        <p class="sub" data-i18n="hero.sub">MDG, IDG und ADG machen Spannungen sichtbar – und liefern klare Schritte: Stabilisieren oder Umbauen.</p>

        <div class="hero__actions">
          <a class="btn btn--primary" href="./diagnose.html?mode=private" id="btnPrivate" data-i18n="cta.private">Jetzt ermitteln (privat)</a>
          <button class="btn btn--ghost" type="button" id="btnBusiness" data-i18n="cta.business">Für Unternehmen</button>
        </div>

        <p class="micro" style="margin-top:.7rem; opacity:.85;" data-i18n="hero.note">
          Privat: sofort starten. Business: Token erforderlich.
        </p>
      </div>
    </div>
  </section>
</main>

<footer class="footer">
  <div class="container footer__grid">
    <div>
      <div class="brand brand--footer">
        <span class="brand__mark" aria-hidden="true">MDG</span>
      </div>
      <p class="micro" data-i18n="footer.tag">Strukturdiagnose für Stabilisierung und Umbau.</p>
    </div>
    <div class="footer__legal">
      <a href="./impressum.html" rel="nofollow">Impressum</a>
      <a href="./datenschutz.html" rel="nofollow">Datenschutz</a>
      <a href="./kontakt.html" rel="nofollow">Kontakt</a>
    </div>
  </div>
</footer>

<!-- Business Token Modal -->
<div class="modal" id="bizModal" hidden>
  <div class="modal__card" role="dialog" aria-modal="true" aria-labelledby="bizTitle">
    <div class="modal__top">
      <div>
        <div class="modal__tag" data-i18n="biz.tag">Business Zugang</div>
        <h2 class="h3" id="bizTitle" style="margin:.45rem 0 0;" data-i18n="biz.title">Token eingeben</h2>
      </div>
      <button class="modal__x" type="button" id="bizClose" aria-label="Schließen">×</button>
    </div>

    <p class="micro" style="margin:0 0 .9rem; opacity:.9;" data-i18n="biz.text">
      Kostenpflichtig (249,99 €). Bitte Token eingeben.
    </p>

    <div class="modal__grid">
      <div>
        <div class="modal__label" data-i18n="biz.label">Token</div>
        <input class="dx-input" id="bizToken" type="text" placeholder="MDG-XXXX-XXXX" autocomplete="off" style="margin-top:.4rem;" />
      </div>
      <div class="modal__row">
        <button class="btn btn--primary" type="button" id="bizGo" data-i18n="biz.next">Weiter</button>
        <button class="btn btn--ghost"   type="button" id="bizCancel" data-i18n="biz.cancel">Abbrechen</button>
        <span class="modal__status" id="bizStatus"></span>
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  "use strict";
  const API_BASE = "https://api.mdg-indikation.de";
  const $  = (s, r=document) => r.querySelector(s);
  const $$ = (s, r=document) => [...r.querySelectorAll(s)];
  const ls = localStorage;
  const ss = sessionStorage;

  /* ── burger ── */
  const burger = $(".burger"), drawer = $(".drawer");
  if (burger && drawer) {
    const open  = () => { drawer.hidden=false; burger.setAttribute("aria-expanded","true");  document.body.classList.add("no-scroll"); };
    const close = () => { drawer.hidden=true;  burger.setAttribute("aria-expanded","false"); document.body.classList.remove("no-scroll"); };
    burger.addEventListener("click", () => drawer.hidden ? open() : close());
    drawer.addEventListener("click", e => { if (!$(".drawer__content",drawer).contains(e.target)) close(); });
    window.addEventListener("keydown", e => { if (e.key==="Escape") close(); });
  }

  /* ── i18n ── */
  const dict = {
    de: {
      "nav.how":"Wie es funktioniert","nav.why":"Warum MDG","nav.faq":"FAQ",
      "hero.title":"Instabilität früh erkennen. Ursache präzise diagnostizieren. Architektur bauen.",
      "hero.sub":"MDG, IDG und ADG machen Spannungen sichtbar – und liefern klare Schritte: Stabilisieren oder Umbauen.",
      "cta.private":"Jetzt ermitteln (privat)","cta.business":"Für Unternehmen",
      "hero.note":"Privat: sofort starten. Business: Token erforderlich.",
      "footer.tag":"Strukturdiagnose für Stabilisierung und Umbau.",
      "biz.tag":"Business Zugang","biz.title":"Token eingeben",
      "biz.text":"Kostenpflichtig (249,99 €). Bitte Token eingeben.",
      "biz.label":"Token","biz.next":"Weiter","biz.cancel":"Abbrechen",
      "biz.errEmpty":"Bitte Token eingeben.","biz.errInvalid":"Token ungültig.","biz.ok":"Token ok. Weiter …"
    },
    tr: {
      "nav.how":"Nasıl çalışır","nav.why":"Neden MDG","nav.faq":"SSS",
      "hero.title":"İstikrarsızlığı erken gör. Nedeni doğru teşhis et. Mimari kur.",
      "hero.sub":"MDG/IDG/ADG gerilimi görünür kılar ve net adımlar verir: stabilize et veya yeniden kur.",
      "cta.private":"Hemen başla (özel)","cta.business":"Şirketler için",
      "hero.note":"Özel: hemen başla. Business: token gerekli.",
      "footer.tag":"Stabilizasyon ve yeniden kurulum için yapı teşhisi.",
      "biz.tag":"Business erişim","biz.title":"Token gir",
      "biz.text":"Şirketler için ücretli (249,99 €). Token giriniz.",
      "biz.label":"Token","biz.next":"Devam","biz.cancel":"İptal",
      "biz.errEmpty":"Token giriniz.","biz.errInvalid":"Token geçersiz.","biz.ok":"Token tamam. Devam …"
    },
    en: {
      "nav.how":"How it works","nav.why":"Why MDG","nav.faq":"FAQ",
      "hero.title":"Detect instability early. Diagnose precisely. Build architecture.",
      "hero.sub":"MDG/IDG/ADG make tension visible and give clear steps: stabilize or rebuild.",
      "cta.private":"Start now (private)","cta.business":"For companies",
      "hero.note":"Private: start instantly. Business: token required.",
      "footer.tag":"Structure diagnosis for stabilization and rebuild.",
      "biz.tag":"Business access","biz.title":"Enter token",
      "biz.text":"For Companies (249,99 €). Please enter token.",
      "biz.label":"Token","biz.next":"Continue","biz.cancel":"Cancel",
      "biz.errEmpty":"Please enter a token.","biz.errInvalid":"Invalid token.","biz.ok":"Token ok. Continuing …"
    }
  };

  function t(k){ const l = ls.getItem("mdg_lang")||"de"; return (dict[l]&&dict[l][k]) || (dict.de[k]||k); }

  function applyLang(lang) {
    if (!dict[lang]) lang = "de";
    ls.setItem("mdg_lang", lang);
    document.documentElement.lang = lang;
    $$("[data-lang]").forEach(b => b.setAttribute("aria-pressed", String(b.dataset.lang===lang)));
    $$("[data-i18n]").forEach(el => {
      const v = dict[lang][el.dataset.i18n];
      if (v !== undefined) el.textContent = v;
    });
  }

  $$("[data-lang]").forEach(b => b.addEventListener("click", () => applyLang(b.dataset.lang)));
  applyLang(ls.getItem("mdg_lang") || "de");

  /* ── modal ── */
  const modal  = $("#bizModal");
  const status = $("#bizStatus");
  const input  = $("#bizToken");

  function openModal(){
    status.textContent = "";
    input.value = (ss.getItem("mdg_business_token") || ls.getItem("mdg_business_token") || "").trim();
    modal.removeAttribute("hidden");
    setTimeout(() => input.focus(), 60);
  }
  function closeModal(){
    modal.setAttribute("hidden","");
    status.textContent = "";
  }

  $("#btnBusiness").addEventListener("click", openModal);
  $("#bizClose")  .addEventListener("click", closeModal);
  $("#bizCancel") .addEventListener("click", closeModal);
  modal.addEventListener("click", e => { if (e.target === modal) closeModal(); });
  window.addEventListener("keydown", e => { if (e.key==="Escape" && !modal.hasAttribute("hidden")) closeModal(); });

  /* ── token verify ── */
  async function verifyToken(token){
    const res  = await fetch(`${API_BASE}/api/token/verify`, {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({token})
    });
    const data = await res.json().catch(()=>({}));
    if (!res.ok) return {ok:false};
    return {ok: Boolean(data?.ok)};
  }

  $("#bizGo").addEventListener("click", async () => {
    const token = (input.value||"").trim();
    if (!token){ status.textContent = t("biz.errEmpty"); return; }
    status.textContent = "…";
    const r = await verifyToken(token).catch(()=>({ok:false}));
    if (!r.ok){ status.textContent = t("biz.errInvalid"); return; }
    status.textContent = t("biz.ok");
    ["mdg_mode","mdg_business_ok","mdg_business_token"].forEach(k => {
      ss.setItem(k, k==="mdg_mode" ? "business" : k==="mdg_business_ok" ? "1" : token);
      ls.setItem(k, k==="mdg_mode" ? "business" : k==="mdg_business_ok" ? "1" : token);
    });
    const lang = ls.getItem("mdg_lang") || "de";
    setTimeout(() => { window.location.href = `./diagnose.html?mode=business&lang=${encodeURIComponent(lang)}`; }, 350);
  });

  input.addEventListener("keydown", e => {
    if (e.key==="Enter")  $("#bizGo").click();
    if (e.key==="Escape") closeModal();
  });
})();
</script>
</body>
</html>
